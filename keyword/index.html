<html>
  <head>
    <title>Keyword Solver</title>
    <meta name="viewport" content="initial-scale=1, maximum-scale=1" />
    <link rel="icon" href="icon.png">
    <script src="dict.js"></script>
    <script src="keyword.js"></script>
    <script>
      const NUM_WORDS = 6;
      const MAX_WORD_LEN = 9;

      let inputs = [];
      let errors = [];

      function init() {
        const wordsMatch = window.location.href.match(/[?&]words=([^&]+)/);
        let initWord = null;
        if (wordsMatch) {
          initWord = wordsMatch[1].split(',');
        }
        const div = document.getElementById('patterns');
        for (let i = 0; i < NUM_WORDS; i++) {
          const section = document.createElement('DIV');
          section.className = 'wordSection';
          div.appendChild(section);

          const label = document.createElement('SPAN');
          label.innerText = 'Word 1:';
          label.className = 'label';
          section.appendChild(label);

          const input = document.createElement('INPUT');
          input.type = 'text';
          input.className = 'input';
          if (initWord) {
            input.value = initWord[i];
          }
          section.appendChild(input);
          inputs.push(input);

          const error = document.createElement('SPAN');
          error.className = 'error';
          section.appendChild(error);
          errors.push(error);

          section.appendChild(document.createElement('BR'));
        }

        inputs[0].focus();
      }

      function validate() {
        let result = true;

        for (let i = 0; i < NUM_WORDS; i++) {
          const error = errors[i];
          error.innerText = '';
          const value = inputs[i].value;
          if (!value) {
            error.innerText =
                'Fill in a word (use underscore or dash or dot for the blank letter).';
            result = false;
          } else {
            const blanksMatch = value.match(/([_.-])/g);
            if (!blanksMatch) {
              error.innerText = 'Use an underscore or dash or dot for the blank letter (like C.T).';
              result = false;
            } else if (blanksMatch.length !== 1) {
              error.innerText = 'Only one blank letter is allowed.';
              result = false;
            } else if (!value.match(/^[A-Za-z_.-]+$/)) {
              error.innerText =
                  'Only letters and blanks (underscores or dashes or dots) are allowed.';
              result = false;
            } else if (value.length > MAX_WORD_LEN) {
              error.innerText = `Maximum of ${MAX_WORD_LEN} letters.`;
              result = false;
            }
          }
        }

        return result;
      }

      function resetSections() {
        document.querySelectorAll('.results_section').forEach(x => x.style.display = 'none');
        document.querySelectorAll('words').forEach(x => x.innerHTML = '');
        document.getElementById('too_many_section').style.display = 'none';
        document.getElementById('failed_section').style.display = 'none';
      }

      function hint() {
        resetSections();
        
        if (!validate()) {
          return;
        }

        const patterns = inputs.map(input => input.value.toUpperCase());
        const allGuesses = getAllGuesses(patterns, dict);
        const min = allGuesses
            .map(guesses => guesses.length)
            .reduce((min, len) => {
              return !min || len < min ? len : min;
            });
        const max = allGuesses
            .map(guesses => guesses.length)
            .reduce((max, len) => {
              return len > max ? len : max;
            }, 0);
        allGuesses.forEach((guesses, index) => {
          const len = guesses.length;
          let hint = `${len} ${len === 1 ? 'possibility' : 'possibilities'}`;
          if (len === min) {
            hint += ' - KEYWORD!';
          } else if (len === max) {
            hint += ' - WORST!';
          }
          errors[index].innerText = hint;
        });
      }

      function submit() {
        resetSections();
        
        if (!validate()) {
          return;
        }

        const patterns = inputs.map(input => input.value.toUpperCase());
        const results = solveIt(patterns, dict);
        if (!results.length) {
          document.getElementById('failed_section').style.display = 'block';
        } else {
          if (results.length > 3) {
            document.getElementById('too_many_section').style.display = 'block';
          } else {
            results.forEach((result, index) => {
              const num = index + 1;
              document.getElementById(`results_section${num}`).style.display = 'block';
              document.getElementById(`answer${num}`).innerText = result.resultWord;
              result.words.forEach(word => {
                const li = document.createElement('LI');
                li.innerText = word;
                li.className = 'answerWord';
                document.getElementById(`words${num}`).appendChild(li);
              });
            });

            document.getElementById('button_section').style.display = 'none';
            document.getElementById('reset_section').style.display = 'block';
          }
        }
      }
    </script>
    <style type="text/css">
      body {
        font-family: sans-serif;
        font-size: 24px;
      }

      .input {
        display: inline;
        font-family: monospace;
        font-size: 30px;
        margin-top: 15px;
        width: 180px;
        text-transform: uppercase;
      }

      .answerWord {
        font-family: monospace;
        margin-left: 20px;
      }

      .label {
        display: inline;
        margin-right: 15px;
      }
      
      .wordSection {
        vertical-align: middle;
      }

      .error {
        color: red;
        margin-left: 10px;
      }

      .results_section {
        margin-top: 20px;
        display: none;
      }

      #failed_section {
        margin-top: 20px;
        display: none;
      }

      #too_many_section {
        margin-top: 20px;
        display: none;
      }

      #reset_section {
        display: none;
      }

      words {
      }

      .submitButton {
        display: inline-block;
        outline: none;
        cursor: pointer;
        border-radius: 3px;
        font-size: 14px;
        font-weight: 500;
        line-height: 16px;
        padding: 2px 16px;
        height: 38px;
        min-width: 96px;
        min-height: 38px;
        border: none;
        color: #fff;
        background-color: rgb(88, 101, 242);
        transition: background-color .17s ease,color .17s ease;
        :hover {
          background-color: rgb(71, 82, 196);
        }
      }

      .answer {
        font-weight: bold;
        color: red;
      }

      .buttonSection {
        margin-top: 20px;
        margin-bottom: 30px;
        width: 276px;
        text-align: center;
      }

      #intro {
        font-size: 14px;
      }
    </style>
  </head>
  <body onload="init()">
    <h2>Keyword Solver</h2>

    <div id="intro">
      Solves <a href="https://www.washingtonpost.com/games/keyword/">Keyword</a>.
      Just for fun. NO CHEATING. üò†
      <br>
      Use underscore (_) or dash (-) or dot ('.') to represent the blank letter.
      <br>
      <br>
    </div>

    <div id="patterns"></div>

    <div id="button_section" class="buttonSection">
      <button id="hint_button" class="submitButton" onclick="hint()">Hint</button>
      <button id="submit_button" class="submitButton" onclick="submit()">Submit</button>
    </div>

    <div id="reset_section" class="buttonSection">
      <button id="reset_button" class="submitButton" onclick="document.location.reload()">Reset</button>
    </div>

    <div id="results_section1" class="results_section">
      <hr></hr>The answer is <span id="answer1" class="answer"></span>.<br><br>
      The words are: <ol id="words1" class="words"></ol>
    </div>

    <div id="results_section2" class="results_section">
      <hr></hr><h3>Alternative #1</h3>
      The answer is <span id="answer2" class="answer"></span>.<br><br>
      The words are: <ol id="words2" class="words"></ol>
    </div>

    <div id="results_section3" class="results_section">
      <hr></hr><h2>Alternative #2</h2>
      The answer is <span id="answer3" class="answer"></span>.<br><br>
      The words are: <ol id="words3" class="words"></ol>
    </div>

    <div id="failed_section">
      I couldn't find the answer! üôÅ
    </div>

    <div id="too_many_section">
      There were more than 3 results. I don't know how to show that yet.
    </div>
  </body>
</html>
